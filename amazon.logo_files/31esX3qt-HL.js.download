(function(g){var f=window.AmazonUIPageJS||window.P,u=f._namespace||f.attributeErrors,b=u?u("P2PAUIAssets@AmazonPayCoupons",""):f;b.guardFatal?b.guardFatal(g)(b,window):b.execute(function(){g(b,window)})})(function(g,f,u){(function(){"undefined"===typeof f.couponINJSRegistered&&(f.couponINJSRegistered=!0,g.when("A","reward-ad-click-logger","reward-ad-logging-constants","load").register("junglee-coupon-js",function(b,k,c){function r(){"function"===typeof l&&l("ld","p2p-coupon-action",{wb:1})}function p(m,
e){navigator.clipboard.writeText(m);var c=a('div[data-claim-code\x3d"'+m+'"]');c.removeClass("hidden");setTimeout(function(){c.addClass("hidden")},e)}var a=b.$,h=f.uet,l=f.uex,n={};document.addEventListener("REVEAL_UNDERLYING_CTA_OF_REWARD_AD",function(m){var e=JSON.parse(m.detail),c=e.couponActionStatus;m=e.message;var b=a('button[data-coupon-id\x3d"'+e.couponId+'"]').parents(".cta-container"),e=a(b.find(".unclaimed-state")),d=a(b.find(".claimed-state")),k=a(b.find(".loader-section")),q=a(e.find(".spacer")),
h=a(e.find(".expire-button"));a(b.find(".expired-state"));b=a('[name\x3d"p2p-xsrf-token"]');"SUCCESS"===c?(null===m.isCouponLocked||null!==m.isCouponLocked&&"true"!==m.isCouponLocked?d.find("a")&&d.find("a").attr("href",m.redemptionUrl):(c=a(d.find(".collected-text")),q=a(d.find(".redeem-btn")),h=a(d.find(".no-cta-text")),c.removeClass("hidden"),null!==q?q.remove():null!==h&&h.remove()),k.addClass("hidden"),e.remove(),d.removeClass("hidden"),b.val(m.xsrfToken)):"ERROR"===c&&(q.removeClass("visibility-hidden"),
h.addClass("visibility-hidden"),k.addClass("hidden"),e.removeClass("hidden"))});var t=function(){var c=Number(a(this).attr("data-coupon-expiry-timestamp")),e=a(this).attr("data-coupon-id")||a(this).attr("id"),f=a('button[data-coupon-id\x3d"'+e+'"]').parents(".cta-container"),p=a(f.find(".unclaimed-state"));a(f.find(".claimed-state"));var d=a(f.find(".loader-section")),w=a(p.find(".spacer")),q=a(p.find(".expire-button")),f=a(f.find(".expired-state")),l=a('[name\x3d"p2p-xsrf-token"]');if(new Date>new Date(c))p.remove(),
f.removeClass("hidden"),q.addClass("visibility-hidden"),d.addClass("hidden");else if(null!==e){w.addClass("visibility-hidden");d.removeClass("hidden");p.addClass("hidden");var t=this;"function"===typeof h&&h("bb","p2p-coupon-action",{wb:1});n[e]||(c=b.ajax("/h/coupon-actions",{method:"post",params:{couponId:e,xsrfToken:l.val()},success:function(a){k.emitMetricsForRewardAdCTAClick(t);document.dispatchEvent(new CustomEvent("REVEAL_UNDERLYING_CTA_OF_REWARD_AD",{detail:JSON.stringify({couponId:e,couponActionStatus:"SUCCESS",
message:a})}));"function"===typeof h&&h("cf","p2p-coupon-action",{wb:1});r();n[e]=null},error:function(){document.dispatchEvent(new CustomEvent("REVEAL_UNDERLYING_CTA_OF_REWARD_AD",{detail:JSON.stringify({couponId:e,couponActionStatus:"ERROR",message:""})}));r();n[e]=null}}),n[e]=c)}};a(document).delegate(".collect-coupon-btn button","click",t);g.declare("callAjaxClip",{clipReward:t});a(document).delegate(".layout-type-four-faceout-click-dp","click",function(c){c.stopPropagation();f.location.href=
a(this).attr("redirection-url")});a(document).delegate(".layout-type-four-detail-link","click",function(a){a.stopPropagation()});a(document).delegate(".copy-code-btn","click",function(b){b=a(this).attr("data-claim-code");p(b,2E3);k.log(this,c.COPY_CODE_CLICK_TYPE)});a(document).delegate(".claim-code-btn a","click",function(b){var e=this,h=a(this).attr("data-claim-code");e.classList.contains("clicked")?(e.classList.remove("clicked"),k.log(this,c.CLAIM_CODE_CLICK_TYPE)):(e.classList.add("clicked"),
b.preventDefault(),b.stopPropagation(),p(h,1E3),setTimeout(function(){e.click()},1E3))})}),g.when("A","mash").register("redemptionRedirectionHandler",function(b,k){var c=!0;g.declare("redemptionClickHandler",{clickHandler:function(b){function f(a){console.log("Call to launchIntentUrlFailCallback MASH API failed",a);c=!1;h.click()}function a(a){console.log("Call to openInExternalBrowser MASH API failed",a);k.launchIntentURL&&"function"===typeof k.launchIntentURL&&k.launchIntentURL({url:l,successCallback:function(){},
failCallback:f})}var h=this,l=h.href;if(!decodeURIComponent(l).includes("/ap/signin")&&!decodeURIComponent(l).includes("primeday.amazonpay"))return!0;c&&k.openInExternalBrowser&&"function"===typeof k.openInExternalBrowser&&(b.preventDefault(),k.openInExternalBrowser({url:l,successCallback:function(){},failCallback:a}))}})}),g.when("A","redemptionClickHandler").execute(function(b,k){b.$(document).delegate(".redeem-btn a","click",k.clickHandler);b.$(document).delegate(".unlock-redeem-btn a","click",
k.clickHandler);b.$(document).delegate(".membership-granted-btn a","click",k.clickHandler);b.$(document).delegate(".coupon-content a","click",k.clickHandler);b.$(document).delegate(".claim-code-btn a","click",k.clickHandler)}),g.when("A").register("signInRedirectionHandler",function(b){g.declare("signInClickHandler",{redirectionClickHandler:function(b){var c=b.target.getAttribute("href");decodeURIComponent(c).includes("/ap/signin")&&decodeURIComponent(c).includes("APAY_REWARDS_AUTHPORTAL_REDIECTION_URL")&&
(b.preventDefault(),c=c.replace("APAY_REWARDS_AUTHPORTAL_REDIECTION_URL",encodeURIComponent(f.location.href)),f.location.assign(c))}})}),g.when("A","signInClickHandler").execute(function(b,f){b.$(document).delegate(".coupon-sign-in-button a","click",f.redirectionClickHandler)}))})();(function(){"undefined"===typeof f.infiniteScrollJSRegistered&&(f.infiniteScrollJSRegistered=!0,g.when("A","apay-rewards-drax-intersection-observer","callAjaxClip","load").register("infinite-scroll-detector",function(b,
k,c){var r=b.$,p=r('[name\x3d"p2p-xsrf-token"]'),a=document.querySelectorAll(".infinite-scroll-detector"),h=document.getElementById("infinite-scroll-insert"),l=document.getElementById("infinite-rewards-loader"),n,t="string"===typeof paginatedBucketSize?parseInt(paginatedBucketSize,10):2,m=0,e=m+t||0,g="undefined"===typeof rewardAdList?[]:rewardAdList,v="undefined"===typeof layoutType?"2":layoutType,d=!1,w=function(){if(!d)if(n=g.slice(m,e),n.length){var a=JSON.stringify({couponIdList:n,layoutType:v});
l.classList.add("infinite-rewards-loader-visible");d=!0;b.ajax("/h/coupon-scroll-actions",{method:"get",params:{widgetParams:a,xsrfToken:p.val()},success:function(a){a.trim()?(r(a).appendTo(h),m=e,e=m+t,setTimeout(function(){for(var a=n,b=0;b<a.length;b++){var d=document.getElementById(a[b]);d&&d.addEventListener("click",c.clipReward)}},100)):e=m=g.length;l.classList.remove("infinite-rewards-loader-visible");d=!1},error:function(){l.classList.remove("infinite-rewards-loader-visible");d=!1}})}else document.getElementsByClassName("reward-list-ending-message")[0].classList.add("infinite-rewards-loader-visible")},
q=function(a,b){a.forEach(function(a){a.isIntersecting&&w()})};g.length&&function(){var b,d={threshold:[0,.5]};b||(b=new f.IntersectionObserver(q,d));a.forEach(function(a){b.observe(a)})}()}))})();(function(){"undefined"===typeof f.yourOffersJSRegistered&&(f.yourOffersJSRegistered=!0,g.when("A","apay-rewards-drax-intersection-observer","callAjaxClip","load").register("your-reward-scroll-detector",function(b,k,c){var r=b.$,p=document.querySelectorAll(".your-offers-scroll-detector"),a=document.getElementById("your-offers-scroll-insert"),
h=document.getElementById("your-offers-scroll-loader"),l=document.getElementsByClassName("your-offers-scroll-ending-message"),n=!1,g=function(a){a.forEach(function(a,b){(b=document.getElementById(b))&&!0===a&&b.addEventListener("click",c.clipReward)})},m=function(){h.classList.remove("your-offers-scroll-loader-visible");n=!1},e=function(){l[0].classList.add("your-offers-scroll-loader-visible")},x=function(){if(!n)if(-1===Number(yourOffersContext.offsetValue))e(),m();else{var d=JSON.parse(yourOffersContext.widgetParams),
c="undefined"===typeof d.filters?null:d.filters,f="undefined"===typeof d.sorts?null:d.sorts,d={offsetValue:Number(yourOffersContext.offsetValue),resultSize:Number(d.resultSize),layoutType:Number(d.layoutType),prevOffset:yourOffersContext.prevOffset,exclusiveStartKey:yourOffersContext.exclusiveStartKey,title:d.title,language:yourOffersContext.language,creativeId:d.creativeId,widgetName:d.widgetName};c&&(d.filters=c);f&&(d.sorts=f);d=JSON.stringify(d);h.classList.add("your-offers-scroll-loader-visible");
n=!0;b.ajax("/h/rewardAd-scroll-actions",{method:"get",params:{widgetParams:d},success:function(b){b.trim()?(r(b).appendTo(a),g(yourOffersContext.rewardAdMap)):e();m()},error:function(){m();e()}})}},v=function(a,b){a.forEach(function(a){a.isIntersecting&&x()})};(function(){var a,b={threshold:[0,.1]};a||(a=new f.IntersectionObserver(v,b));p.forEach(function(b){a.observe(b)})})()}))})();g.when("A","ready").execute(function(b){function k(b,f){var a=document.getElementsByClassName("s-bottom-sheet")[0];
f?c(a).removeClass("aok-hidden"):c(a).addClass("aok-hidden");var h=c(a).find(".merchant-logo")[0],k=c(a).find(".merchant-name")[0];b.actionToUnlock?(k.innerText=b.actionToUnlock,c(h).removeClass("show-image")):(k.innerText="",b.merchantLogo?(h.src=b.merchantLogo,c(h).addClass("show-image")):c(h).removeClass("show-image"));c(a).find(".description")[0].innerText=b.description;c(a).find(".sub-description")[0].innerText=b.subDescription;c(a).find(".stul-heading")[0].innerText=b.stepsToUnlock;h=c(a).find(".coupon-details .reward-ad-detail-link")[0];
h.href=b.detailsPageUrl;c(h).attr("data-coupon-id",f);c(a).find(".unlock-redeem-btn span a")[0].href=b.redemptionUrl;h=c(a).find(".unlock-redeem-btn span a")[0];h.innerText=b.buttonText;c(h).attr("data-coupon-id",f);var g="";b.stepsToUnlockContent.forEach(function(a){g=g+"\x3cli\x3e"+a+"\x3c/li\x3e"});c(a).find(".stul-content")[0].innerHTML=g;return a}var c=b.$;g.when("a-sheet").execute("unlock-bottom-sheet",function(g){b.on("a:sheet:afterHide:s-bottom-sheet",function(){k({actionToUnlock:"",description:"",
subDescription:"",stepsToUnlock:"",stepsToUnlockContent:[],detailsPageUrl:"#",buttonText:"",redemptionUrl:"#",merchantLogo:""},"")});b.declarative("s-load-bottom-sheet","click",function(b){function a(){var a;a=g.create({name:"s-bottom-sheet",height:500,closeType:"icon",inlineContent:n});g.showSheet(a)}function h(){var a=CustomEvent,b,e=["P2PAUIAssets-AmazonPayCoupons","AmazonUI"];b="AUIClients/AmazonUI P2PAUIAssets-ScratchCard P2PAUIAssets-AmazonPayCoupons P2PAUIAssets-Logging CSM AUIClients/APayDashboardUIAssets".split(" ");
for(var h=[],g=0;g<document.styleSheets.length;g++)for(var d=document.styleSheets[g],k=0;k<e.length;k++){var l=e[k];d.href&&d.href.trim()&&d.href.includes(l)&&!1===h.includes(d.ownerNode.outerHTML)&&h.push(d.ownerNode.outerHTML)}e=[];for(g=0;g<b.length;g++)for(d=b[g],k=0;k<document.scripts.length;k++)l=document.scripts[k],l.outerHTML&&l.outerHTML.includes(d)&&!1===e.includes(l.outerHTML.replace(/\n/g,""))&&e.push(l.outerHTML.replace(/\n/g,""));b=JSON.stringify({bottomSheetType:"AUI_UNLOCK_NOW",html:n.outerHTML.replace(/\n/g,
"")+document.getElementsByName("p2p-xsrf-token")[0].outerHTML,css:h.join(""),js:e.join(""),loggingMetadata:JSON.stringify(Array.from(f.rewardAdLogEntryMap.loggingMetadata.entries())),faceoutRewardData:JSON.stringify(Array.from(f.rewardAdLogEntryMap.faceoutRewardData.entries()))});b=JSON.stringify({useCase:"REWARDS",payload:b});a=new a("OpenNativeBottomSheet",{detail:b});c(n).addClass("aok-hidden");document.dispatchEvent(a)}b.$event.stopPropagation();b.$event.preventDefault();b=c(b.$event.target).attr("data-coupon-id");
var l=bottomSheetUnlockRewards.get(b),n=k(l,b);"undefined"!==typeof isNativeEnvironment&&isNativeEnvironment?h():a()})})})});
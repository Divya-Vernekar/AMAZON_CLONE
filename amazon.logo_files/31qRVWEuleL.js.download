(function(h){var d=window.AmazonUIPageJS||window.P,l=d._namespace||d.attributeErrors,e=l?l("P2PAUIAssets@ScratchCard",""):d;e.guardFatal?e.guardFatal(h)(e,window):e.execute(function(){h(e,window)})})(function(h,d,l){(function(){var e=new Image;e.setAttribute("crossOrigin","");"undefined"!==typeof d.SCRATCH_CARD_COVER_BACKGROUND&&(e.src=d.SCRATCH_CARD_COVER_BACKGROUND);e.onload=function(){var h=document.createElement("canvas");h.width=e.width;h.height=e.height;h.getContext("2d").drawImage(e,0,0);d.SCRATCH_CARD_COVER_BACKGROUND=
h.toDataURL("image/jpeg")}})();(function(){"undefined"===typeof d.scratchCardJSRegistered&&(d.scratchCardJSRegistered=!0,h.when("A","load").register("junglee-scratchCard-js",function(e){function l(){"function"===typeof G&&G("ld","p2p-fulfill-reward",{wb:1})}function H(b){document.dispatchEvent(new CustomEvent("ScratchCard",{detail:b}))}function la(b,I){try{var k=b.parent()[0].cloneNode(!0),g=c(k).find("img.fgi");g.attr("src",d.SCRATCH_CARD_COVER_BACKGROUND);g.height("100%").width("100%");c("body")[0].appendChild(k);
c(k).css({top:(d.pageYOffset||document.documentElement.scrollTop)+b.parent()[0].getBoundingClientRect().y+"px",left:(d.pageXOffset||document.documentElement.scrollLeft)+b.parent()[0].getBoundingClientRect().x+"px",height:b.parent()[0].getBoundingClientRect().height+"px",width:b.parent()[0].getBoundingClientRect().width+"px",position:"absolute","z-index":2E3,overflow:"hidden"});setTimeout(function(){e.animate(c(k),{top:(d.pageYOffset||document.documentElement.scrollTop)+(c(d).height()-400)/2+"px",
left:(d.pageXOffset||document.documentElement.scrollLeft)+(c(d).width()-300)/2+"px",height:"400px",width:"300px"},200,"linear",function(){I();c("body")[0].removeChild(k)})},50)}catch(C){I()}}function Y(b,c){var k,g=0;b&&"touchmove"===b.type&&(k=b.touches[0].clientX,g=b.touches[0].clientY);b&&"mousemove"===b.type&&(k=b.pageX,g=b.pageY);b=c.getBoundingClientRect().top;c=c.getBoundingClientRect().left;return{x:k-c-(d.pageXOffset||document.documentElement.scrollLeft),y:g-b-(d.pageYOffset||document.documentElement.scrollTop)}}
function ma(b){b=document.getElementById(b).parentElement.cloneNode(!0);b.appendChild(Z[0]);b.style.visibility="hidden";b=b.outerHTML.replace(/\n/g,"");for(var c=["AUIClients/AmazonUI","P2PAUIAssets-ScratchCard","P2PAUIAssets-AmazonPayCoupons"],k=[],g=0;g<document.styleSheets.length;g++){var e=document.styleSheets[g];if(e.href&&e.href.trim())for(var h=0;h<c.length;h++)e.href.includes(c[h])&&!1===k.includes(e.ownerNode.outerHTML)&&k.push(e.ownerNode.outerHTML)}c="csa CSM AUIClients/AmazonUI P2PAUIAssets-ScratchCard P2PAUIAssets-AmazonPayCoupons P2PAUIAssets-Logging AUIClients/APayDashboardUIAssets".split(" ");
g=[];for(e=0;e<c.length;e++)for(var h=c[e],n=0;n<document.scripts.length;n++){var l=document.scripts[n];l.outerHTML&&l.outerHTML.includes(h)&&!1===g.includes(l.outerHTML.replace(/\n/g,""))&&g.push(l.outerHTML.replace(/\n/g,""))}b=JSON.stringify({scratchCardEventType:"OPEN_OVERLAY",parameters:JSON.stringify({widgetHtml:b,widgetCSS:k.join(""),widgetJS:g.join(""),scratchCardCoverBackground:d.SCRATCH_CARD_COVER_BACKGROUND,hostEndpoint:location.href,rewardAdLogEntryMapLoggingMetadata:JSON.stringify(Array.from(d.rewardAdLogEntryMap.loggingMetadata.entries())),
rewardAdLogEntryMapFaceoutRewardData:JSON.stringify(Array.from(d.rewardAdLogEntryMap.faceoutRewardData.entries()))})});return JSON.stringify({useCase:"SCRATCH_CARD",payload:b})}function aa(b,c,d,e){b=JSON.stringify({scratchCardEventType:"FULFILL_REWARD",parameters:JSON.stringify({rewardAd:b,rewardType:c,fulfilRewardStatus:d,message:e})});return JSON.stringify({useCase:"SCRATCH_CARD",payload:b})}var c=e.$,Q=0,R=0,Z=c('[name\x3d"p2p-xsrf-token"]'),na={COUPONS:"sc-background-revealed",BLNT:"sc-background-revealed-blnt",
CB:"sc-background-revealed-cb"},ba={coupon:"COUPON",CB:"CASHBACK",BLNT:"BLNT"},oa={PRE:"Something Went Wrong!!",FAILED:"PROCESSING",SUCCESS:"PROCESSING"},K=d.uet,G=d.uex,ca,S,D=!1;e.declarative("a-scratchCard",["click"],function(b){function I(a){k(a)}function k(a){a.stopPropagation();y.classList.remove("sc-container-prevent-scroll");d.scrollTo(Q,R);t.classList.add("sc-display-none");m.classList.add("sc-display-none");t.removeEventListener("click",g);m.removeEventListener("click",g);y.removeChild(L);
D=!1;a=JSON.stringify({scratchCardEventType:"CLOSE_OVERLAY",parameters:""});a=JSON.stringify({useCase:"SCRATCH_CARD",payload:a});H(a)}function g(a){a.stopPropagation()}function C(a){try{da||M||(T=!0,p=Y(a,f),z.removeChild(U),u.classList.remove("sc-display-none"),u.classList.remove("sc-hidden"))}catch(v){}}function J(a){if(T){a.preventDefault();a=Y(a,f);for(var v=Math.sqrt(Math.pow(a.x-p.x,2)+Math.pow(a.y-p.y,2)),b=Math.atan2(a.x-p.x,a.y-p.y),c,d,e=0;e<v;e++)c=p.x+Math.sin(b)*e,d=p.y+Math.cos(b)*e,
w.globalCompositeOperation="destination-out",w.beginPath(),w.arc(c,d,25,0,2*Math.PI,!1),w.fill(),w.closePath();p=a;a=w.getImageData(0,0,300,400).data;v=a.length;b=v/32;for(d=c=0;d<v;d+=32)0===parseInt(a[d],10)&&c++;(Math.round(c/b*100)||0)>pa&&(f.parentNode&&f.parentNode.removeChild(f),x.removeChild(E),F.classList.remove("sc-hidden"),qa(ca,S.rewardType,{OVERLAY_BACKGROUND_CONTENT:t,ACTUAL_BACKGROUND_HTML:ea,BACKGROUND_HTML:u}),t.classList.remove("sc-display-none"),t.addEventListener("click",g),x.appendChild(t),
m.classList.remove("sc-display-none"),V.appendChild(m),fa(A),f.removeEventListener("mousedown",C,!1),f.removeEventListener("mousemove",J,!1),f.removeEventListener("mouseup",n,!1),f.removeEventListener("touchstart",C,!1),f.removeEventListener("touchmove",J,!1),f.removeEventListener("touchend",n,!1))}}function n(){T=!1}function G(){if(W){var a=document.createElement("canvas");a.addEventListener("click",g);a.classList.add("sc-canvas");a.width=300;a.height=400;a.id="canvasBg";var v=a.getContext("2d"),
b=new Image;b.src=W;b.onload=function(){v.drawImage(b,0,0);f.parentNode.insertBefore(a,f)}}else ga()}function ga(){var a=document.createElement("div");a.classList.add("sc-canvas");a.addEventListener("click",g);a.appendChild(u);z.appendChild(a);x.appendChild(z)}function fa(a){document.getElementById(a).classList.add("hidden");document.getElementById(a+"-scratched").classList.remove("hidden")}function q(a,b){a=document.createElement(a);if(b)for(var c=0;c<b.length;c++)a.classList.add(b[c]);return a}
function ha(a,b,c,d){console.error("Unable to fulfil the reward with rewardAd ",b,a);try{var e=JSON.parse(a.http.responseText).FullFillmentStatus;e&&("coupon"===c?N(d,b,!1):"CB"===c&&ia(d,b,oa[e]||"Something Went Wrong!!"))}catch(f){"coupon"===c?N(d,b,!1):"CB"===c&&ia(d,b,"Something Went Wrong!!")}X(d.ACTUAL_BACKGROUND_HTML)}function qa(a,b,c){var d=a.scratchCardView.activityId,f=a.scratchCardView.id,g=ba[b]||ba.BLNT,h=a.rewardViews&&0<a.rewardViews.length?a.rewardViews[0].id:"",k="/h/fulfill-reward/action/scratch?xsrfToken\x3d"+
encodeURIComponent(Z.val());"function"===typeof K&&K("bb","p2p-fulfill-reward",{wb:1});e.ajax(k,{method:"post",params:{activityId:d,scratchCardId:f,rewardType:g,actualRewardId:h},paramsFormat:"json",contentType:"application/json; charset\x3dutf-8",success:function(d){H(aa(a,b,"SUCCESS",d));"coupon"===b&&N(c,a,!0);X(c.ACTUAL_BACKGROUND_HTML);"function"===typeof K&&K("cf","p2p-fulfill-reward",{wb:1});l()},error:function(d){H(aa(a,b,"ERROR",d));ha(d,a,b,c);l()}})}function X(a){c(a).height()<1.31*c(a).width()&&
c(a).height(1.31*c(a).width())}function ia(a,b,c){a.BACKGROUND_HTML.getElementsByClassName("sc-reveal-processing")[0].classList.add("sc-display-none");a.ACTUAL_BACKGROUND_HTML.getElementsByClassName("sc-reveal-processing")[0].classList.add("sc-display-none");b=a.BACKGROUND_HTML.getElementsByClassName("sc-reveal-failed")[0];b.classList.remove("sc-display-none");b.innerHTML=c;b=a.ACTUAL_BACKGROUND_HTML.getElementsByClassName("sc-reveal-failed")[0];b.classList.remove("sc-display-none");b.innerHTML=c}
function N(a,b,d){if(d){var e=a.BACKGROUND_HTML.getElementsByClassName("coupon-cta-issued")[0];b=a.ACTUAL_BACKGROUND_HTML.getElementsByClassName("coupon-cta-issued")[0];e.classList.remove("hidden");b.classList.remove("hidden");e.classList.contains("spacer visibility-hidden")&&e.getElementsByClassName("spacer visibility-hidden")[0].classList.add("hidden");b.classList.contains("spacer visibility-hidden")&&b.getElementsByClassName("spacer visibility-hidden")[0].classList.add("hidden");c(e).find(".collect-coupon-btn button").length&&
(h.when("callAjaxClip").execute("clipReward",function(a){c(e).find(".collect-coupon-btn button")[0].addEventListener("click",a.clipReward)}),h.when("redemptionClickHandler").execute(function(a){c(".redeem-btn a").click(a.clickHandler);c(".unlock-redeem-btn a").click(a.clickHandler);c(".membership-granted-btn a").click(a.clickHandler);c(".coupon-content a").click(a.clickHandler)}));h.when("sc-reveal-reward-ad-click-log-event-binder").execute(function(b){b.bindEvent(a.BACKGROUND_HTML)})}}if(!D){D=!0;
var B=JSON.parse(b.$currentTarget.context.dataset.aScratchcard),r=B.scratchCardData;ca=B.rewardAd;S=B.scratchCardData;if(S.isExpired)D=!1;else{var A=r.rewardId||"",W=r.backgroundImage||"",da=r.isDisabled||!1,M=r.isScratched,pa=r.scratchThreshold||30,ra=r.expiryDateText,B=na[r.type],ea=document.getElementById(A+"-scratched"),u=document.getElementById(A).getElementsByClassName(B)[0].cloneNode(!0);document.getElementsByTagName("html");var y=document.getElementsByTagName("body")[0],ja=Object.assign({},
r.overlayData),t=document.getElementById(A).getElementsByClassName(B+"-overlay-content")[0].cloneNode(!0),m=document.getElementById(A).getElementsByClassName("sc-background-overlay-footer")[0].cloneNode(!0),L=q("div",["sc-wrapper"]);L.addEventListener("click",I);var O=q("div",["sc-container"]),U=q("div",["sc-expire-date"]),ka=q("div",["sc-top-container"]),P=q("span");P.addEventListener("click",k);O.appendChild(ka);var x=q("div",["sc-middle-container"]),F=document.createElement("div");F.classList.add("sc-hidden");
F.classList.add("sc-background-overlay-header");F.innerHTML=ja.background.header;x.appendChild(F);var E=document.createElement("div"),z=q("div",["sc-canvas-wrapper"]),f=q("canvas",["sc-canvas"]),w=f.getContext("2d");f.width=300;f.height=400;u.style.width=300;u.style["border-radius"]="5px";var V=document.createElement("div");document.addEventListener("FULFILL_REWARD",function(a){var b=JSON.parse(a.detail.parameters);a=b.rewardType;var c=b.rewardAd,d=b.fulfilRewardStatus,b=b.message,e={OVERLAY_BACKGROUND_CONTENT:t,
ACTUAL_BACKGROUND_HTML:ea,BACKGROUND_HTML:u};fa(c.scratchCardView.id);"SUCCESS"===d?("coupon"===a&&N(e,c,!0),X(e.ACTUAL_BACKGROUND_HTML)):ha(b,c,a,e)},{once:!0});if("undefined"!==typeof isNativeEnvironment&&isNativeEnvironment)H(ma(A,b)),D=!1;else{la(b.$currentTarget,function(){if(M)ga();else{da||G();f.addEventListener("click",g);z.appendChild(f);U.innerHTML=ra;z.appendChild(U);x.appendChild(z);var a=new Image;a.setAttribute("crossOrigin","");a.src=M?W:d.SCRATCH_CARD_COVER_BACKGROUND;a.onload=function(){w.drawImage(a,
0,0,300,400)}}O.appendChild(x);V.classList.add("sc-bottom-container");O.appendChild(V);Q=d.pageXOffset||document.documentElement.scrollLeft;R=d.pageYOffset||document.documentElement.scrollTop;y.classList.add("sc-container-prevent-scroll");c(y).css("top","-"+R+"px");c(y).css("left","-"+Q+"px");P.classList.add("sc-overlay-cross-icon");P.innerHTML='\x3ci class\x3d"a-icon a-icon-close-white a-icon-mini" role\x3d"img" aria-label\x3d"close"\x3e\x3c/i\x3e';ka.appendChild(P);f.addEventListener("mousedown",
C,!1);f.addEventListener("mousemove",J,!1);f.addEventListener("mouseup",n,!1);f.addEventListener("touchstart",C,!1);f.addEventListener("touchmove",J,!1);f.addEventListener("touchend",n,!1);L.appendChild(O);y.appendChild(L);M||(E.classList.add("sc-foreground-overlay-content"),E.addEventListener("click",g),E.innerHTML=ja.foreground.content,x.appendChild(E));if(m&&0<m.children.length){var b=m.children[0].getElementsByClassName("cta-section")[0].getElementsByClassName("unclaimed-state")[0],e=m.children[0].getElementsByClassName("cta-section")[0].getElementsByClassName("loader-section")[0],
h=m.children[0].getElementsByClassName("cta-section")[0].getElementsByClassName("claimed-state")[0];c(b).click(function(){b.classList.add("hidden");e.classList.remove("hidden");setTimeout(function(){e.classList.add("hidden");h.classList.remove("hidden")},5E3)})}});var T=!1,p}}}})}))})()});